import spidev
import time

# Define SPI bus and device (chip enable pin)
spi = spidev.SpiDev()
spi.open(0, 0)  # (bus, device)

def read_soil_moisture(channel):
    # Sending start bit, single-ended channel selection, and null bits
    adc_data = spi.xfer2([1, (8 + channel) << 4, 0])
    raw_value = ((adc_data[1] & 3) << 8) + adc_data[2]  # Combining the received bits
    # Calculating the percentage value?
    percentage = int(((1023 - raw_value) / 1023.0) * 100)
    return percentage
try:
    while True:
        # Assuming the soil moisture sensor is connected to channel 0
        moisture_level = read_soil_moisture(channel=0)
        print("Soil Moisture Level: {}%".format(moisture_level))
        time.sleep(0.1)  # Delay between readings

except KeyboardInterrupt:
    spi.close()
